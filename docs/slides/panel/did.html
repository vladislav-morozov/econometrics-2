<!DOCTYPE html>
<html lang="en"><head>
<link href="../../themes/favicon.ico" rel="icon">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0de45b8b5f35a93596f1d788d60c4c11.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.js" defer="true"></script>
<link href="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/sc-sb-title-1.0.0/sc_sb_title.js" defer="true"></script>
<link href="../../site_libs/quarto-contrib/grid-no-htext-1.0.0/grid_no_htext.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Vladislav Morozov">
  <title>Advanced Econometrics – Difference-in-Differences</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-cb5537517b990794adf0c72e32550bcc.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
   

  <!-- This is what works with Quarto and MathJax 3+ -->

  <script>

    MathJax = {

      tex: {

        tags: 'ams',  // should be 'ams', 'none', or 'all'

        macros: {

          vect: ["\\mathbf{#1}", 1],

          mat: ["\\mathbf{#1}", 1], 

  

          bA: "\\boldsymbol{A}",

          bB: "\\boldsymbol{B}",

          bC: "\\boldsymbol{C}",

          bD: "\\boldsymbol{D}",

          bE: "\\boldsymbol{E}",

          bF: "\\boldsymbol{F}",

          bG: "\\boldsymbol{G}",

          bH: "\\boldsymbol{H}",

          bI: "\\boldsymbol{I}",

          bJ: "\\boldsymbol{J}",

          bK: "\\boldsymbol{K}",

          bL: "\\boldsymbol{L}",

          bM: "\\boldsymbol{M}",

          bN: "\\boldsymbol{N}",

          bP: "\\boldsymbol{P}",

          bQ: "\\boldsymbol{Q}",

          bR: "\\boldsymbol{R}",

          bS: "\\boldsymbol{S}",

          bT: "\\boldsymbol{T}",

          bU: "\\boldsymbol{U}",

          bV: "\\boldsymbol{V}",

          bW: "\\boldsymbol{W}",

          bX: "\\boldsymbol{X}",

          bY: "\\boldsymbol{Y}",

          bZ: "\\boldsymbol{Z}",

          ba: "\\boldsymbol{a}",

          bb: "\\boldsymbol{b}",

          bc: "\\boldsymbol{c}",

          bd: "\\boldsymbol{d}",

          be: "\\boldsymbol{e}",

          bg: "\\boldsymbol{g}",

          bh: "\\boldsymbol{h}",

          bi: "\\boldsymbol{\\imath}",

          bm: "\\boldsymbol{m}",

          bp: "\\boldsymbol{p}",

          bq: "\\boldsymbol{q}",

          br: "\\boldsymbol{r}",

          bs: "\\boldsymbol{s}",

          bt: "\\boldsymbol{t}",

          bu: "\\boldsymbol{u}",

          bv: "\\boldsymbol{v}",

          bw: "\\boldsymbol{w}",

          bx: "\\boldsymbol{x}",

          by: "\\boldsymbol{y}",

  

          Acal: "\\mathcal{A}",

          Bcal: "\\mathcal{B}",

          Ccal: "\\mathcal{C}",

          Dcal: "\\mathcal{D}",

          Ecal: "\\mathcal{E}",

          Fcal: "\\mathcal{F}",

          Gcal: "\\mathcal{G}",

          Hcal: "\\mathcal{H}",

          Ical: "\\mathcal{I}",

          Jcal: "\\mathcal{J}",

          Kcal: "\\mathcal{K}",

          Lcal: "\\mathcal{L}",

          Mcal: "\\mathcal{M}",

          Ncal: "\\mathcal{N}",

          Ocal: "\\mathcal{O}",

          Pcal: "\\mathcal{P}",

          Qcal: "\\mathcal{Q}",

          Rcal: "\\mathcal{R}",

          Scal: "\\mathcal{S}",

          Tcal: "\\mathcal{T}",

          Ucal: "\\mathcal{U}",

          Vcal: "\\mathcal{V}",

          Wcal: "\\mathcal{W}",

          Xcal: "\\mathcal{X}",

          Ycal: "\\mathcal{Y}",

          Zcal: "\\mathcal{Z}",

  

          A: "\\mathbb{A}",

          B: "\\mathbb{B}",

          C: "\\mathbb{C}",

          D: "\\mathbb{D}",

          E: "\\mathbb{E}",

          F: "\\mathbb{F}",

          G: "\\mathbb{G}",

          H: "\\mathbb{H}",

          I: "\\mathbb{I}",

          J: "\\mathbb{J}",

          K: "\\mathbb{K}",

          L: "\\mathbb{L}",

          M: "\\mathbb{M}",

          N: "\\mathbb{N}",

          O: "\\mathbb{O}",

          P: "\\mathbb{P}",

          Q: "\\mathbb{Q}",

          R: "\\mathbb{R}",

          S: "\\mathbb{S}",

          T: "\\mathbb{T}",

          U: "\\mathbb{U}",

          V: "\\mathbb{V}",

          W: "\\mathbb{W}",

          X: "\\mathbb{X}",

          Y: "\\mathbb{Y}",

          Z: "\\mathbb{Z}",

  

          bAlpha: "\\boldsymbol{\\Alpha}",

          bBeta: "\\boldsymbol{\\beta}",

          bDelta: "\\boldsymbol{\\delta}",

          bEta: "\\boldsymbol{\\eta}",

          bGamma: "\\boldsymbol{\\Gamma}",

          bLambda: "\\boldsymbol{\\Lambda}",

          bOmega: "\\boldsymbol{\\Omega}",

          bPhi: "\\boldsymbol{\\Phi}",

          bPi: "\\boldsymbol{\\Pi}",

          bPsi: "\\boldsymbol{\\Psi}",

          bSigma: "\\boldsymbol{\\Sigma}",

          bTau: "\\boldsymbol{\\tau}",

          bXi: "\\boldsymbol{\\Xi}",

          bbeta: "\\boldsymbol{\\beta}",

          bdelta: "\\boldsymbol{\\delta}",

          blambda: "\\boldsymbol{\\lambda}",

          bmu: "\\boldsymbol{\\mu}",

          bphi: "\\boldsymbol{\\phi}",

          bpi: "\\boldsymbol{\\pi}",

          bpsi: "\\boldsymbol{\\psi}",

          brho: "\\boldsymbol{\\rho}",

          bsigma: "\\boldsymbol{\\sigma}",

          btau: "\\boldsymbol{\\tau}",

          bxi: "\\boldsymbol{\\xi}",

          bEta: "\\boldsymbol{\\eta}",

          bPhi: "\\boldsymbol{\\Phi}",

          bPi: "\\boldsymbol{\\Pi}",

          bPsi: "\\boldsymbol{\\Psi}",

          bXi: "\\boldsymbol{\\Xi}",

          blambda: "\\boldsymbol{\\lambda}",

          bmu: "\\boldsymbol{\\mu}",

          bphi: "\\boldsymbol{\\phi}",

          bpi: "\\boldsymbol{\\pi}",

          bpsi: "\\boldsymbol{\\psi}",

          brho: "\\boldsymbol{\\rho}",

          bsigma: "\\boldsymbol{\\sigma}",

          btheta: "\\boldsymbol{\\theta}",

                     

          curl: ["\\left\\lbrace#1\\right\\rbrace", 1],

          floor: ["\\left\\lfloor#1\\right\\rfloor", 1],

          ceil: ["\\left\\lceil#1\\right\\rceil", 1],

          abs: ["\\left\\lvert#1\\right\\rvert", 1],

          norm: ["\\left\\lVert#1\\right\\rVert", 1],

  

          avar: "\\mathrm{avar}",

          var: "\\mathrm{var}",

          cov: "\\mathrm{cov}",

  

          argmin: "\\operatorname*{arg\\,min}",

          argmax: "\\operatorname*{arg\\,max}",

          argsup: "\\operatorname*{arg\\,sup}",

          arginf: "\\operatorname*{arg\\,inf}",

        }

      }

    };

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <script type="text/javascript">
  window.PlotlyConfig = {MathJaxConfig: 'local'};
  if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
  if (typeof require !== 'undefined') {
  require.undef("plotly");
  requirejs.config({
      paths: {
          'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']
      }
  });
  require(['plotly'], function(Plotly) {
      window._Plotly = Plotly;
  });
  }
  </script>

  <meta name="description" content="Difference-in-differences estimation: parallel trends, ATT identification, regression characterization, application to minimum wage (lecture notes slides).">
<meta property="og:title" content="Difference-in-Differences – Advanced Econometrics">
<meta property="og:description" content="Difference-in-differences estimation: parallel trends, ATT identification, regression characterization, application to minimum wage (lecture notes slides).">
<meta property="og:site_name" content="Advanced Econometrics">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#045D5D" data-footer="" class="quarto-title-block center">
  <h1 class="title">Difference-in-Differences</h1>
  <p class="subtitle">Causal Inference of Binary Treatment under Parallel Trends</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Vladislav Morozov 
</div>
</div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Contents</h2>
<ul>
<li class="fragment"><a href="#/introduction" id="/toc-introduction">Introduction</a></li>
<li class="fragment"><a href="#/identification" id="/toc-identification">Identification</a></li>
<li class="fragment"><a href="#/estimation-and-regression-view" id="/toc-estimation-and-regression-view">Estimation and Regression View</a></li>
<li class="fragment"><a href="#/some-extensions" id="/toc-some-extensions">Some Extensions</a></li>
<li class="fragment"><a href="#/empirical-application" id="/toc-empirical-application">Empirical Application</a></li>
<li class="fragment"><a href="#/recap-and-conclusions" id="/toc-recap-and-conclusions">Recap and Conclusions</a></li>
</ul>
</nav>
</section>
<section>
<section id="introduction" class="title-slide slide level2 center" data-background="#00100F">
<h2>Introduction</h2>

</section>
<section id="lecture-info" class="title-slide slide level3 center" data-background="#43464B" data-visibility="uncounted">
<h3>Lecture Info</h3>

</section>
<section id="learning-outcomes" class="slide level4">
<h4>Learning Outcomes</h4>
<p>This lecture is about handling changes over time in causal studies with a binary treatment</p>
<p><br></p>
<p>By the end, you should be able to</p>
<ul>
<li class="fragment">State the parallel trends assumption</li>
<li class="fragment">Identify the ATT using a difference-in-differences (DiD) strategy</li>
<li class="fragment">Give a regression characterization of DiD</li>
</ul>
</section>
<section id="references" class="slide level4">
<h4>References</h4>
<div>
<p>Textbooks:</p>
<ul>
<li>Chapter 18 in <span class="citation" data-cites="Huntington-Klein2025EffectIntroductionResearch">Huntington-Klein (<a href="#/references-1" role="doc-biblioref" onclick="">2025</a>)</span></li>
<li>“Difference-in-Differences” in <span class="citation" data-cites="Cunningham2021CausalInferenceMixtape">Cunningham (<a href="#/references-1" role="doc-biblioref" onclick="">2021</a>)</span></li>
<li>Chapter 13.2 in <span class="citation" data-cites="Wooldridge2020IntroductoryEconometricsModern">Wooldridge (<a href="#/references-1" role="doc-biblioref" onclick="">2020</a>)</span></li>
<li>Chapter 18 in <span class="citation" data-cites="Hansen2022Econometrics">Hansen (<a href="#/references-1" role="doc-biblioref" onclick="">2022</a>)</span></li>
</ul>
<p><span class="citation" data-cites="Roth2023WhatsTrendingDifferenceinDifferences">Roth et al. (<a href="#/references-1" role="doc-biblioref" onclick="">2023</a>)</span>: good overview of recent advances</p>
</div>
</section>

<section id="empirical-motivation" class="title-slide slide level3 center" data-background="#43464B" data-visibility="uncounted">
<h3>Empirical Motivation</h3>

</section>
<section id="empirical-question" class="slide level4 scrollable">
<h4>Empirical Question</h4>
<div class="rounded-box">
<p>Does raising the minimum wage reduce employment?</p>
</div>
<ul>
<li class="fragment">Micro 1 with perfectly competitive markets and elastic labor demand say yes</li>
<li class="fragment">But what about imperfect competition, general equilibrium effects of some workers having more spending power, inelastic labor demand, …?</li>
</ul>
<div class="fragment">
<p>Not necessarily obvious what the overall effect is. See <span class="citation" data-cites="Neumark2014RevisitingMinimumWage">Neumark, Salas, and Wascher (<a href="#/references-1" role="doc-biblioref" onclick="">2014</a>)</span> for history of question</p>
</div>
</section>
</section>
<section>
<section id="identification" class="title-slide slide level2 center" data-background="#00100F">
<h2>Identification</h2>

</section>
<section id="motivation" class="slide level4">
<h4>Motivation</h4>
<p>Previous lecture — “event studies” with “no trends” in average untreated outcome: <span class="math inline">\(\E[Y_{it}^0]\)</span> does not depend on <span class="math inline">\(t\)</span></p>
<p><br></p>
<div class="rounded-box">
<p>Assumption of no trends <span class="highlight">difficult to justify</span> unless time horizon very short</p>
</div>
<ul>
<li class="fragment">If there are trends, event studies do not work</li>
<li class="fragment">What can we do?</li>
</ul>
</section>
<section id="two-unit-thought-experiment" class="title-slide slide level3 center" data-background="#43464B" data-visibility="uncounted">
<h3>Two-Unit Thought Experiment</h3>

</section>
<section id="setting-two-units-with-binary-treatment" class="slide level4">
<h4>Setting: Two Units with Binary Treatment</h4>
<p>To start: very simplified case</p>
<ul>
<li class="fragment">Two periods of time: <span class="math inline">\(t=1, 2\)</span></li>
<li class="fragment">Two units: unit 1 with outcomes <span class="math inline">\(Y\)</span> and unit 2 with outcome <span class="math inline">\(Z\)</span></li>
<li class="fragment">Second unit treated between <span class="math inline">\(t=1\)</span> and <span class="math inline">\(t=2\)</span>. First unit not treated</li>
</ul>
<div class="fragment">
<p>Potential outcomes at time <span class="math inline">\(t\)</span>: <span class="math inline">\(Y_t^d\)</span> and <span class="math inline">\(Z_t^d\)</span> for treatment values <span class="math inline">\(d=0, 1\)</span></p>
</div>
</section>
<section id="object-of-interest" class="slide level4">
<h4>Object of Interest</h4>
<p><br></p>
<p>Object of interest: <span class="highlight">treatment effect</span> of unit 2 at <span class="math inline">\(t=2\)</span>: <span class="math display">\[
\delta_Z = Z_2^1- Z_2^0
\]</span></p>
</section>
<section id="change-in-outcomes" class="slide level4">
<h4>Change in Outcomes</h4>
<p>Observed outcomes satisfy <span class="math display">\[
Z_{1} = Z_1^0, \quad Z_{2} = Z_{2}^1
\]</span></p>
<div class="fragment">
<p>Difference in outcomes (like in event studies): <span class="math display">\[
\begin{aligned}
Z_2 - Z_1 &amp; = \gamma_T + \delta_T\\
\gamma_T &amp; = Z_{2}^0 - Z_{1}^0
\end{aligned}
\]</span> <span class="math inline">\(\gamma_T\)</span> — trend in outcomes without treatment</p>
</div>
</section>
<section id="role-of-assumptions-of-no-trends" class="slide level4">
<h4>Role of Assumptions of No Trends</h4>
<p>Strict no trends assumption from previous lecture: <span id="eq-panel-did-no-trends"><span class="math display">\[
\gamma_T = 0
\tag{1}\]</span></span></p>
<div class="fragment">
<ul>
<li class="fragment">Under (<a href="#/eq-panel-did-no-trends" class="quarto-xref">1</a>) <span class="math inline">\(Z_2-Z_1=\delta_T\)</span> — identification of treatment effect</li>
<li class="fragment">Without (<a href="#/eq-panel-did-no-trends" class="quarto-xref">1</a>) change in outcome — sum of treatment effect and evolution over time</li>
<li class="fragment">Hard to justify (<a href="#/eq-panel-did-no-trends" class="quarto-xref">1</a>) outside of high-frequency data</li>
</ul>
</div>
</section>
<section id="trend-for-other-unit" class="slide level4">
<h4>Trend for Other Unit</h4>
<p>Outcomes of other unit satisfy: <span class="math display">\[
Y_1 = Y_1^0, \quad Y_2 = Y_2^0
\]</span></p>
<div class="fragment">
<p><br></p>
<p>Difference in outcomes: only trend in outcomes without treatment <span class="math display">\[
\begin{aligned}
Y_2 - Y_1 &amp; = \gamma_U\\
\gamma_U &amp; = Y_2^0 - Y_1^0
\end{aligned}
\]</span></p>
</div>
</section>
<section id="parallel-trends" class="slide level4">
<h4>Parallel Trends</h4>
<p>Difference in differences of outcomes of units: <span class="math display">\[
\begin{aligned}
(Z_2- Z_1) - (Y_2- Y_1) = \delta_T + (\gamma_T - \gamma_U)
\end{aligned}
\]</span></p>
<div class="fragment">
<p><br></p>
What if the two units had the same evolution?
<div class="rounded-box">
<p><strong>Assumption</strong> (<em>literal parallel trends</em>): <span class="math display">\[
\gamma_T = \gamma_U
\]</span></p>
</div>
</div>
</section>
<section id="difference-in-differences-with-two-units" class="slide level4">
<h4>Difference-in-Differences with Two Units</h4>
<p>Under parallel trends identify <span class="math inline">\(\delta_T\)</span> as <span class="math display">\[
\delta_T = (Z_2- Z_1) - (Y_2- Y_1)
\]</span></p>
<ul>
<li class="fragment">Differences two unit-specific differences — hence called difference-in-difference<span class="highlight">s</span></li>
<li class="fragment">Old argument, goes back at least to <span class="citation" data-cites="Snow1856ModeCommunicationCholera">Snow (<a href="#/references-1" role="doc-biblioref" onclick="">1856</a>)</span></li>
</ul>
</section>

<section id="differences-in-differences" class="title-slide slide level3 center" data-background="#43464B" data-visibility="uncounted">
<h3>Differences-in-Differences</h3>

</section>
<section id="limitations-of-two-unit-approach" class="slide level4">
<h4>Limitations of Two Unit Approach</h4>
<p>Two unit situation might be</p>
<ul>
<li class="fragment">Unrealistic: literal parallel trends might not hold</li>
<li class="fragment">Uninteresting: if you want to predict the effect for a new unit</li>
</ul>
<div class="fragment">
<p><br></p>
<p><span class="math inline">\(\Rightarrow\)</span> Now consider an approach with <span class="highlight">multiple</span> units</p>
</div>
</section>
<section id="setting" class="slide level4">
<h4>Setting</h4>
<ul>
<li class="fragment">Units indexed by <span class="math inline">\(i=1, \dots, N\)</span>, time indexed by <span class="math inline">\(t=1, 2\)</span></li>
<li class="fragment">All outcomes labeled <span class="math inline">\(Y_{it}\)</span></li>
<li class="fragment">Treatment pattern: realized treatment indicator <span class="math inline">\(D_{it}\)</span>
<ul>
<li class="fragment">Untreated/control group (group <span class="math inline">\(U\)</span>): <span class="math inline">\(D_{i1}=D_{i2}=0\)</span></li>
<li class="fragment">Treated group (group <span class="math inline">\(T\)</span>): <span class="math inline">\(D_{i1}=0\)</span>, <span class="math inline">\(D_{i2}=1\)</span></li>
</ul></li>
</ul>
</section>
<section id="potential-outcomes" class="slide level4">
<h4>Potential Outcomes</h4>
<p>Potential outcomes <span class="math inline">\(Y_{it}^d\)</span> for <span class="math inline">\(d=0, 1\)</span></p>
<ul>
<li class="fragment">Units in group <span class="math inline">\(T\)</span>: <span class="math display">\[
Y_{i1} = Y_{i1}^0, \quad Y_{i2} = Y_{i2}^1
\]</span></li>
<li class="fragment">Units in group <span class="math inline">\(U\)</span> <span class="math display">\[
Y_{i1} = Y_{i1}^0, \quad Y_{i2}= Y_{i2}^0
\]</span></li>
</ul>
</section>
<section id="change-in-outcomes-for-treated" class="slide level4">
<h4>Change in Outcomes for Treated</h4>
<p>Decompose average of <span class="math inline">\(Y_{i2}-Y_{i1}\)</span> for treated units (<span class="math inline">\(T\)</span>): <span class="math display">\[
\E[Y_{i2} - Y_{i1}|T] = \E[Y_{i2}^1 - Y_{i2}^0|T]  + \E[Y_{i2}^0- Y_{i1}^0|T]
\]</span></p>
<ul>
<li class="fragment"><span class="math inline">\(\E[Y_{i2}^1 - Y_{i2}^0|T]\)</span> — parameter of interest, the <span class="highlight">average treatment effect for the treated</span> (ATT)</li>
<li class="fragment"><span class="math inline">\(\E[Y_{i2}^0- Y_{i1}^0|T]\)</span> trend in outcomes without treatment</li>
</ul>
</section>
<section id="change-in-outcomes-for-untreated" class="slide level4">
<h4>Change in Outcomes for Untreated</h4>
<p><br></p>
<p>For untreated units (<span class="math inline">\(U\)</span>): <span class="math display">\[
\E[Y_{i2}-Y_{i1}|U] = \E[Y_{i2}^0 - Y_{i1}^0|U]
\]</span></p>
<p><br></p>
<p>Only the time trend is present</p>
</section>
<section id="parallel-trends-assumption" class="slide level4">
<h4>Parallel Trends Assumption</h4>
Same trends on average:
<div class="rounded-box">
<p><strong>Assumption</strong> (<em>average parallel trends</em>): <span class="math display">\[
\E[Y_{i2}^0 - Y_{i1}^0|T] = \E[Y_{i2}^0 - Y_{i1}^0|U]
\]</span></p>
</div>
<p>Then <span class="highlight">difference-in-differences</span> <span class="math display">\[
\begin{aligned}
\E[Y_{i2}^1 - Y_{i2}^0|T] &amp; = \E[Y_{i2}-Y_{i1}|T] - \E[Y_{i2}-Y_{i1}|U]
\end{aligned}
\]</span> Expressed ATT in terms of distribution of the data</p>
</section>
<section id="result-statement" class="slide level4">
<h4>Result Statement</h4>
<div class="rounded-box">
<div id="prp-causal-did-att-canonical" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 (DiD Identification)</strong></span> Suppose that <span class="math inline">\(P(D_{i1}=D_{i2} =0)&gt;0\)</span> and <span class="math inline">\(P(D_{i1}=0, D_{i2}=1)&gt;0\)</span>.</p>
<p>Then the ATT is <span class="math inline">\(\E[Y_{i2}^1 - Y_{i2}^0|T]\)</span> is identified in terms of a difference in differences: <span class="math display">\[
\begin{aligned}
\E[Y_{i2}^1 - Y_{i2}^0|T] &amp; = \E[Y_{i2}-Y_{i1}|T] - \E[Y_{i2}-Y_{i1}|U]
\end{aligned}
\]</span></p>
</div>
</div>
<p><br></p>
<p>Assumption means that both treated and untreated units exist</p>
</section>
<section id="discussion" class="slide level4">
<h4>Discussion</h4>
<p>What does DiD actually do?</p>
<ul>
<li class="fragment">Solves selection in treatment by
<ul>
<li class="fragment">Considering effects only for the treated (ATT instead of ATE<span class="math inline">\(=\E[Y_{i2}^1 - Y_{i2}^0]\)</span>)</li>
<li class="fragment">Compares treated units to themselves</li>
</ul></li>
<li class="fragment">Solves evolution over time by
<ul>
<li class="fragment">Assuming parallel trends without treatment</li>
<li class="fragment">Identifies trend from untreated unit</li>
</ul></li>
</ul>
</section>
</section>
<section>
<section id="estimation-and-regression-view" class="title-slide slide level2 center" data-background="#00100F">
<h2>Estimation and Regression View</h2>
<!-- ### Estimation and Regression View {background="#43464B" visibility="uncounted"} -->
</section>
<section id="did-estimator" class="slide level4">
<h4>DiD Estimator</h4>
<p>We have <span class="math inline">\(ATT = \E[Y_{i2}-Y_{i1}|T] - \E[Y_{i2}-Y_{i1}|U]\)</span></p>
<div class="fragment">
Sample version: the <span class="highlight">DiD estimator</span>:
<div class="rounded-box">
<p><span id="eq-causal-did-canonical-did-estimator"><span class="math display">\[
\begin{aligned}
\hspace{-2.6cm} &amp; \hspace{-2.6cm}\widehat{ATT}^{DID} \\
\hspace{-2.6cm} &amp; \hspace{-2.6cm} = \dfrac{1}{N_T}\sum_{Treated} (Y_{i2}-Y_{i1}) - \dfrac{1}{N_U}\sum_{Untreated} (Y_{i2}-Y_{i1})
\end{aligned}
\tag{2}\]</span></span></p>
</div>
<p><span class="math inline">\(N_T\)</span> — number of treated units, <span class="math inline">\(N_U\)</span> — of untreated units</p>
</div>
</section>
<section id="regression-representation-coefficients" class="slide level4">
<h4>Regression Representation: Coefficients</h4>
<p>Can frame DiD estimator differently</p>
<div class="fragment">
<p>Define “coefficients”: <span class="math display">\[
\begin{aligned}
\alpha_i &amp; = Y_{i1}^0, \\
\gamma &amp; = \E[Y_{i2}^0 - Y_{i1}^0 |T], \\
\delta &amp; = \E[Y_{i2}^1 - Y_{i2}^0 |T].
\end{aligned}
\]</span></p>
<p>By parallel trends, can also have <span class="math inline">\(\gamma = \E[Y_{i2}^0 - Y_{i1}^0 |U]\)</span></p>
</div>
</section>
<section id="regression-representation-outcomes" class="slide level4">
<h4>Regression Representation: Outcomes</h4>
<p>Recall <span class="math inline">\(D_{it}\)</span>. Define indicator of second period: <span class="math display">\[
SP_{it} = \I\curl{t=2}
\]</span></p>
<div class="fragment">
<p>Can express outcomes as <span class="math display">\[
Y_{it} = \begin{cases}
\alpha_i + u_{it}, &amp; SP_{it} =0, D_{i2}= 0, 1, \\
\alpha_i + \gamma + u_{it}, &amp; SP_{it} = 1, D_{i2} = 0, \\
\alpha_ i + \gamma + \delta + u_{it}, &amp; SP_{it}, D_{i2} = 1,
\end{cases}
\]</span> What is the <span class="math inline">\(u_{it}\)</span>?</p>
</div>
</section>
<section id="twfe-representation" class="slide level4">
<h4>TWFE Representation</h4>
<p>Compact form of representation: <span id="eq-causal-did-twfe-general"><span class="math display">\[
Y_{it} = \alpha_i + \gamma SP_{it} + \delta D_{it} + u_{it}
\tag{3}\]</span></span> <a href="#/eq-causal-did-twfe-general" class="quarto-xref">Equation&nbsp;3</a> is called <span class="highlight">two-way fixed effect</span> model (more on that in next lecture)</p>
<div class="fragment">
<p>Can eliminate <span class="math inline">\(\alpha_i\)</span> by taking <span class="highlight">first differences</span> across time to get <span id="eq-causal-did-twfe"><span class="math display">\[
Y_{i2}- Y_{i1} = \gamma + \delta D_{it} + u_{i2}
\tag{4}\]</span></span></p>
</div>
</section>
<section id="regression-representation-result" class="slide level4">
<h4>Regression Representation: Result</h4>
<div class="rounded-box">
<div id="prp-causal-did-canonical-did-is-twfe" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 2 (Canonical DiD is TWFE)</strong></span> The OLS estimator <span class="math inline">\(\hat{\delta}\)</span> in <a href="#/eq-causal-did-twfe" class="quarto-xref">Equation&nbsp;4</a> satisfies <span class="math display">\[
\hat{\delta} = \widehat{ATT}^{DID},
\]</span> for the ATT estimator of <a href="#/eq-causal-did-canonical-did-estimator" class="quarto-xref">Equation&nbsp;2</a>.</p>
</div>
</div>
<p>Proof: by brute force evaluating the OLS estimator, see exercise set 3</p>
</section>
<section id="regression-representation-discussion" class="slide level4">
<h4>Regression Representation: Discussion</h4>
<ul>
<li class="fragment">Like for event studies: managed to get linear regression in a nonparametric context</li>
<li class="fragment">Consistency of OLS = consistency of <span class="math inline">\(\widehat{ATT}^{DID}\)</span> (exercise: prove that parallel trends equivalent to strict exogeneity of <span class="math inline">\(D_{it}\)</span>)</li>
<li class="fragment">Regression results: can use all results for OLS, including limit theory and inference</li>
</ul>
</section>
<section id="limitations" class="slide level4">
<h4>Limitations</h4>
<p>Two obvious ones:</p>
<ul>
<li class="fragment">Need parallel trends</li>
<li class="fragment">We did not identify average effect for the untreated and the overall ATE</li>
</ul>
<p><br></p>
<div class="fragment">
<p>Can relax a bit if we have another “control” group — DDD identification and estimator (see <span class="citation" data-cites="Cunningham2021CausalInferenceMixtape">Cunningham (<a href="#/references-1" role="doc-biblioref" onclick="">2021</a>)</span> or <span class="citation" data-cites="Wooldridge2020IntroductoryEconometricsModern">Wooldridge (<a href="#/references-1" role="doc-biblioref" onclick="">2020</a>)</span>)</p>
</div>
</section></section>
<section>
<section id="some-extensions" class="title-slide slide level2 center" data-background="#00100F">
<h2>Some Extensions</h2>

</section>
<section id="adding-covariates-i-conditioning" class="slide level4">
<h4>Adding Covariates I: Conditioning</h4>
<p>What if there are extra covariates <span class="math inline">\(\bX_i = (\bX_{i1}, \bX_{i2})\)</span>?</p>
<div class="fragment">
<p>Can relax parallel trends to conditional parallel trends: for each (or some) values <span class="math inline">\(\bx=(\bx_1, \bx_2)\)</span> <span class="math display">\[ \small
\E[Y_{i2}^0 - Y_{i1}^0 |T, \bX_{it}=\bx] = \E[Y_{i2}^0 - Y_{i1}^0 |T, \bX_{i}=\bx]
\]</span></p>
</div>
<div class="fragment">
<p>Same argument as before: identify <span class="highlight">conditional ATT</span> <span class="math display">\[\small
CATT(\bx) = \E[Y_{i2}^0 - Y_{i1}^0 |T, \bX_{i}=\bx]
\]</span></p>
</div>
<div class="fragment">
<p>If parallel trends hold for all possible <span class="math inline">\(\bx\)</span>, can also identify the overall (<span class="math inline">\(\bX\)</span>-unconditional) ATT</p>
<div class="footer">

</div>
</div>
</section>
<section id="adding-covariates-ii-assuming-linearity" class="slide level4">
<h4>Adding Covariates II: Assuming Linearity</h4>
<p>Often see <span class="highlight">linearity assumptions</span> on the causal model in the form: <span class="math display">\[
\begin{aligned}
Y_{it}^d = Y_{it}^0 + d(Y_{i2}^1- Y_{i2}^0) + \bX_{it}'\bbeta_i
\end{aligned}
\]</span></p>
<div class="fragment">
<p>Can estimate ATT consistently from TWFE regression <span class="math display">\[
Y_{i2}-Y_{i1} = \gamma + \delta D_{it} + (\bX_{i2}-\bX_{i1})'\bbeta + u_{it},
\]</span> if <span class="math inline">\(\bbeta\)</span> appropriately defined (think of OLS estimator under heterogeneous coefficient causal model)</p>
</div>
</section>
<section id="adding-more-periods-setting" class="slide level4">
<h4>Adding More Periods: Setting</h4>
<p>Can accommodate more periods of data</p>
<ul>
<li class="fragment"><span class="math inline">\(T\geq 2\)</span></li>
<li class="fragment">Two groups: never treated (<span class="math inline">\(U\)</span>) and treated, treatment starts between <span class="math inline">\(t_0-1\)</span> and <span class="math inline">\(t_0\)</span></li>
<li class="fragment">Treatment indicators <span class="math inline">\(D_{it\tau}\)</span>, <span class="math inline">\(t, \tau=1,\dots, T\)</span>:
<ul>
<li class="fragment">Untreated units have <span class="math inline">\(D_{it\tau}=0\)</span> for all <span class="math inline">\(t, \tau\)</span></li>
<li class="fragment">Treated units <span class="math inline">\(D_{it\tau}=1\)</span> if and only if <span class="math inline">\(t=\tau\)</span> and <span class="math inline">\(t\geq t_0\)</span></li>
</ul></li>
</ul>
</section>
<section id="adding-more-periods-twfe" class="slide level4">
<h4>Adding More Periods: TWFE</h4>
<p>Multi-period specification: <span class="math display">\[ \small
\begin{aligned}
Y_{it} &amp;  = \alpha_i + \gamma_t + \sum_{\tau=t_0}^T \delta_\tau D_{it\tau}  + U_{it},\\
\alpha_i &amp; = Y_{i1}^0, \\
\gamma_t &amp; = \E[Y_{it}^0- Y_{i1}^0|T],\\
\delta_t &amp; = \E[Y_{it}^1- Y_{it}^0|T]
\end{aligned}
\]</span> OLS consistent for dynamic ATTs <span class="math inline">\(\delta_T\)</span> if<br>
<span class="math display">\[ \small
\E[Y_{it}^0- Y_{i1}^0|T]=\E[Y_{it}^0- Y_{i1}^0|U]
\]</span></p>
<div class="footer">

</div>
</section>
<section id="adding-more-groups" class="slide level4">
<h4>Adding More Groups</h4>
<ul>
<li class="fragment">So far: had two groups (untreated and treated at some specific point in time)</li>
<li class="fragment">In many settings: different units receive treatment in different periods (e.g.&nbsp;states implement same laws at different times)</li>
<li class="fragment">Can learn with such <span class="highlight">staggered timing</span></li>
<li class="fragment">Need to be careful, cannot just do TWFE, need more sophisticated approaches</li>
</ul>
<div class="fragment">
<p>See section 3 in <span class="citation" data-cites="Roth2023WhatsTrendingDifferenceinDifferences">Roth et al. (<a href="#/references-1" role="doc-biblioref" onclick="">2023</a>)</span></p>
</div>
</section></section>
<section>
<section id="empirical-application" class="title-slide slide level2 center" data-background="#00100F">
<h2>Empirical Application</h2>

</section>
<section id="context-and-setting" class="title-slide slide level3 center" data-background="#43464B" data-visibility="uncounted">
<h3>Context and Setting</h3>

</section>
<section id="context" class="slide level4">
<h4>Context</h4>
<p>Recall: interested in effect of raising minimum wage</p>
<div class="fragment">
<p>We replicate classical paper of<br>
<span class="citation" data-cites="Card1994MinimumWagesEmployment">Card and Krueger (<a href="#/references-1" role="doc-biblioref" onclick="">1994</a>)</span>. Background of their analysis</p>
<ul>
<li class="fragment">New Jersey (NJ) raised its minimum wage in 1992</li>
<li class="fragment">Neighboring Pennsylvania (PA) did not<br>
</li>
<li class="fragment">NJ and PA touch in Philadelphia area — likely fairly similar populations there</li>
</ul>
</div>
</section>
<section id="data-description" class="slide level4 scrollable">
<h4>Data Description</h4>
<p><span class="citation" data-cites="Card1994MinimumWagesEmployment">Card and Krueger (<a href="#/references-1" role="doc-biblioref" onclick="">1994</a>)</span> collect data on fast food restaurants in NJ and PA before and after NJ minimum wage raise:</p>
<ul>
<li class="fragment">Units <span class="math inline">\(i\)</span> are restaurants</li>
<li class="fragment">Groups <span class="math inline">\(T\)</span> and <span class="math inline">\(U\)</span> are <span class="math inline">\(i\)</span> in NJ and in PA, respectively</li>
<li class="fragment">Outcome: number of “full-time equivalent” workers (sum of full-time, managers, and half of part-time workers)</li>
</ul>
<div class="footer">
<p>Data can be obtained from <a href="https://davidcard.berkeley.edu/data_sets.html">Card’s website</a></p>
</div>
</section>
<section id="loading-and-looking-at-the-data" class="slide level4">
<h4>Loading and Looking at the Data</h4>
<div id="cbd0fb04" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Loading and processing the data</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a>ck_data <span class="op">=</span> pd.read_csv(<span class="st">"data/card-krueger-1994.csv"</span>)</span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a><span class="co"># Compute the number of full time employees</span></span>
<span id="cb1-4"><a></a>ck_data <span class="op">=</span> ck_data.replace(<span class="st">"."</span>, np.nan)</span>
<span id="cb1-5"><a></a>ck_data <span class="op">=</span> ck_data.astype(<span class="st">"float64"</span>)</span>
<span id="cb1-6"><a></a>ck_data[<span class="st">"emp_ft"</span>] <span class="op">=</span> (</span>
<span id="cb1-7"><a></a>    ck_data[<span class="st">"empft"</span>] <span class="op">+</span> </span>
<span id="cb1-8"><a></a>    <span class="fl">0.5</span><span class="op">*</span>ck_data[<span class="st">"emppt"</span>] <span class="op">+</span></span>
<span id="cb1-9"><a></a>    ck_data[<span class="st">"nmgrs"</span>]</span>
<span id="cb1-10"><a></a>)</span>
<span id="cb1-11"><a></a></span>
<span id="cb1-12"><a></a><span class="co"># Extract only the necessary columns</span></span>
<span id="cb1-13"><a></a>ck_data <span class="op">=</span> ck_data.loc[:, [<span class="st">"store"</span>, <span class="st">"state"</span>, <span class="st">"time"</span>, <span class="st">"emp_ft"</span>, <span class="st">"hoursopen"</span>]]</span>
<span id="cb1-14"><a></a></span>
<span id="cb1-15"><a></a><span class="co"># Insert any missing (store, time) rows</span></span>
<span id="cb1-16"><a></a>full_index <span class="op">=</span> pd.MultiIndex.from_product(</span>
<span id="cb1-17"><a></a>    [ck_data[<span class="st">"store"</span>].unique(), ck_data[<span class="st">"time"</span>].unique()],</span>
<span id="cb1-18"><a></a>    names <span class="op">=</span> [<span class="st">"store"</span>, <span class="st">"time"</span>]</span>
<span id="cb1-19"><a></a>)</span>
<span id="cb1-20"><a></a>ck_data <span class="op">=</span> (</span>
<span id="cb1-21"><a></a>    ck_data.set_index([<span class="st">"store"</span>, <span class="st">"time"</span>])</span>
<span id="cb1-22"><a></a>        .reindex(full_index)</span>
<span id="cb1-23"><a></a>        .reset_index()</span>
<span id="cb1-24"><a></a>)</span>
<span id="cb1-25"><a></a></span>
<span id="cb1-26"><a></a><span class="co"># Drop stores with missing employee numbers</span></span>
<span id="cb1-27"><a></a>stores_with_nan <span class="op">=</span> (</span>
<span id="cb1-28"><a></a>    ck_data.groupby(<span class="st">"store"</span>)[<span class="st">"emp_ft"</span>]</span>
<span id="cb1-29"><a></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> g: g.isnull().<span class="bu">any</span>())</span>
<span id="cb1-30"><a></a>)</span>
<span id="cb1-31"><a></a>stores_with_nan <span class="op">=</span> stores_with_nan[stores_with_nan].index </span>
<span id="cb1-32"><a></a>ck_data <span class="op">=</span> (</span>
<span id="cb1-33"><a></a>    ck_data.loc[</span>
<span id="cb1-34"><a></a>        <span class="op">~</span>ck_data[<span class="st">"store"</span>].isin(stores_with_nan), </span>
<span id="cb1-35"><a></a>        :</span>
<span id="cb1-36"><a></a>        ]</span>
<span id="cb1-37"><a></a>)</span>
<span id="cb1-38"><a></a></span>
<span id="cb1-39"><a></a><span class="co"># Recode states and times more descriptively</span></span>
<span id="cb1-40"><a></a>states_dict <span class="op">=</span> {<span class="dv">0</span>: <span class="st">"PA"</span>, <span class="dv">1</span>: <span class="st">"NJ"</span>}</span>
<span id="cb1-41"><a></a>ck_data[<span class="st">"state_name"</span>] <span class="op">=</span> ck_data[<span class="st">"state"</span>].replace(states_dict)</span>
<span id="cb1-42"><a></a>time_dict <span class="op">=</span> {<span class="dv">0</span>:<span class="st">"Before"</span>, <span class="dv">1</span>:<span class="st">"After"</span>}</span>
<span id="cb1-43"><a></a>ck_data[<span class="st">"time_name"</span>] <span class="op">=</span> ck_data[<span class="st">"time"</span>].replace(time_dict)</span>
<span id="cb1-44"><a></a></span>
<span id="cb1-45"><a></a><span class="co"># Set index</span></span>
<span id="cb1-46"><a></a>ck_data <span class="op">=</span> ck_data.set_index([<span class="st">"store"</span>, <span class="st">"time_name"</span>])</span>
<span id="cb1-47"><a></a>ck_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">emp_ft</th>
<th data-quarto-table-cell-role="th">hoursopen</th>
<th data-quarto-table-cell-role="th">state_name</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">store</th>
<th data-quarto-table-cell-role="th">time_name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">46.0</td>
<td data-quarto-table-cell-role="th">Before</td>
<td>0.0</td>
<td>0.0</td>
<td>40.5</td>
<td>17.0</td>
<td>PA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">After</td>
<td>1.0</td>
<td>0.0</td>
<td>24.5</td>
<td>17.0</td>
<td>PA</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">49.0</td>
<td data-quarto-table-cell-role="th">Before</td>
<td>0.0</td>
<td>0.0</td>
<td>14.5</td>
<td>13.0</td>
<td>PA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">After</td>
<td>1.0</td>
<td>0.0</td>
<td>11.5</td>
<td>13.0</td>
<td>PA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">506.0</td>
<td data-quarto-table-cell-role="th">Before</td>
<td>0.0</td>
<td>0.0</td>
<td>8.5</td>
<td>10.0</td>
<td>PA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="footer">
<p>Note: our data is <span class="highlight">multi-indexed</span> by <code>store</code> and <code>time_name</code> — frequent way to work with panel data</p>
</div>
</section>

<section id="estimation-results" class="title-slide slide level3 center" data-background="#43464B" data-visibility="uncounted">
<h3>Estimation Results</h3>

</section>
<section id="tabulating-averages" class="slide level4">
<h4>Tabulating Averages</h4>
<p>The key components of difference-in-differences are the (state, year)-specific average outcomes:</p>
<div id="c0d63167" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Computing (state, year)-averages</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a>emp_means <span class="op">=</span> ck_data.groupby(by<span class="op">=</span>[<span class="st">"state_name"</span>, <span class="st">"time_name"</span>])[<span class="st">"emp_ft"</span>].mean()</span>
<span id="cb2-2"><a></a><span class="bu">print</span>(emp_means)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>state_name  time_name
NJ          After        20.925566
            Before       20.475728
PA          After        21.140000
            Before       23.440000
Name: emp_ft, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="applying-did" class="slide level4">
<h4>Applying DiD</h4>
<p>It is easy to compute averages now. Recall that <code>NJ</code> is the treated group. Applying DiD:</p>
<div id="46ffc2d6" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Applying DiD manually</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a>( </span>
<span id="cb4-2"><a></a>    (emp_means.loc[(<span class="st">"NJ"</span>, <span class="st">"After"</span>)] <span class="op">-</span> emp_means.loc[(<span class="st">"NJ"</span>, <span class="st">"Before"</span>)])</span>
<span id="cb4-3"><a></a>    <span class="op">-</span> (emp_means.loc[(<span class="st">"PA"</span>, <span class="st">"After"</span>)] <span class="op">-</span> emp_means.loc[(<span class="st">"PA"</span>, <span class="st">"Before"</span>)])</span>
<span id="cb4-4"><a></a>).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>np.float64(2.75)</code></pre>
</div>
</div>
<p>Positive estimate! Increasing minimum wage lead to average gain of 2.75 full-time equivalent workers in fast food in NJ</p>
</section>
<section id="visualizing-1992-employment-levels" class="slide level4">
<h4>Visualizing 1992 Employment Levels</h4>
<div id="cb862309" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>                            <div id="5a1c4f5c-0600-4164-b7b2-380749b6fb40" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("5a1c4f5c-0600-4164-b7b2-380749b6fb40")) {                    Plotly.newPlot(                        "5a1c4f5c-0600-4164-b7b2-380749b6fb40",                        [{"colorscale":[[0.0,"rgb(247,251,255)"],[0.125,"rgb(222,235,247)"],[0.25,"rgb(198,219,239)"],[0.375,"rgb(158,202,225)"],[0.5,"rgb(107,174,214)"],[0.625,"rgb(66,146,198)"],[0.75,"rgb(33,113,181)"],[0.875,"rgb(8,81,156)"],[1.0,"rgb(8,48,107)"]],"hovertemplate":"\u003cb\u003e%{location}\u003c\u002fb\u003e\u003cbr\u003eFT-equivalent workers: %{z:.2f}","locationmode":"USA-states","locations":["NJ","PA"],"name":"Actual","showscale":false,"z":[20.92556634304207,21.14],"zmax":22,"zmin":18,"type":"choropleth","geo":"geo"},{"colorbar":{"len":0.8,"thickness":15,"tickvals":[18,22],"title":{"font":{"color":"black","size":12},"side":"right","text":"Number of Workers"},"x":1,"y":0.5},"colorscale":[[0.0,"rgb(247,251,255)"],[0.125,"rgb(222,235,247)"],[0.25,"rgb(198,219,239)"],[0.375,"rgb(158,202,225)"],[0.5,"rgb(107,174,214)"],[0.625,"rgb(66,146,198)"],[0.75,"rgb(33,113,181)"],[0.875,"rgb(8,81,156)"],[1.0,"rgb(8,48,107)"]],"hovertemplate":"\u003cb\u003e%{location}\u003c\u002fb\u003e\u003cbr\u003eFT-equivalent workers: %{z:.2f}","locationmode":"USA-states","locations":["NJ","PA"],"name":"Counterfactual","z":[18.175728155339804,21.14],"zmax":22,"zmin":18,"type":"choropleth","geo":"geo2"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"geo":{"domain":{"x":[0,0.48],"y":[0.0,1.0]},"projection":{"type":"mercator","scale":40},"center":{"lat":39.9,"lon":-75.1},"visible":false,"bgcolor":"rgb(201, 201, 201)","landcolor":"rgb(201, 201, 201)","lakecolor":"rgb(201, 201, 201)","showocean":true,"oceancolor":"rgb(136, 136, 136)"},"geo2":{"domain":{"x":[0.52,1],"y":[0.0,1.0]},"projection":{"type":"mercator","scale":40},"center":{"lat":39.9,"lon":-75.1},"visible":false,"bgcolor":"rgb(201, 201, 201)","landcolor":"rgb(201, 201, 201)","lakecolor":"rgb(201, 201, 201)","showocean":true,"oceancolor":"rgb(136, 136, 136)"},"annotations":[{"font":{"size":16},"showarrow":false,"text":"Actual employment","x":0.225,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"Employment without minimum wage changes","x":0.775,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"font":{"family":"Arial","color":"black"},"title":{"font":{"color":"black","size":20},"text":"\u003cb\u003eRealized vs. Counterfactual Employment\u003c\u002fb\u003e","x":0.03,"xanchor":"left","y":0.97,"yanchor":"top"},"margin":{"l":20,"r":20,"t":60,"b":20},"plot_bgcolor":"whitesmoke","paper_bgcolor":"whitesmoke"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('5a1c4f5c-0600-4164-b7b2-380749b6fb40');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</section>
<section id="regression-implementation-i" class="slide level4 scrollable">
<h4>Regression Implementation I</h4>
<p>Easiest way to obtain standard error of estimated effect — use regression characterization</p>
<div class="fragment">
<p>We have a choice</p>
<ul>
<li class="fragment">Differenced equation <span class="math display">\[
Y_{i2} - Y_{i1} = \gamma + \delta D_{i2} + U_{i2}
\]</span></li>
<li class="fragment">Undifferenced equation <span class="math display">\[
Y_{it} = \alpha_i + \gamma SP_{it} + \delta D_{i2} + U_{it}
\]</span></li>
</ul>
</div>
</section>
<section id="estimation-of-differenced-equation" class="slide level4 scrollable">
<h4>Estimation of Differenced Equation</h4>
<p>Differenced equation — easy to estimate with <code>OLS</code> in <code>statsmodels</code></p>
<div id="db8578d0" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Regression with differenced equation</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a>endog <span class="op">=</span> ck_data.groupby(by<span class="op">=</span><span class="st">"store"</span>)[<span class="st">"emp_ft"</span>].diff().dropna()</span>
<span id="cb6-2"><a></a>exog <span class="op">=</span> ck_data.loc[(<span class="bu">slice</span>(<span class="va">None</span>),<span class="st">"After"</span>), <span class="st">"state"</span>]</span>
<span id="cb6-3"><a></a>exog.name <span class="op">=</span> <span class="st">"Treated"</span></span>
<span id="cb6-4"><a></a>exog <span class="op">=</span> sm.add_constant(exog)</span>
<span id="cb6-5"><a></a></span>
<span id="cb6-6"><a></a><span class="co"># Run OLS</span></span>
<span id="cb6-7"><a></a>fitted_model <span class="op">=</span> sm.OLS(endog, exog).fit(cov_type<span class="op">=</span><span class="st">"HC0"</span>)</span>
<span id="cb6-8"><a></a><span class="bu">print</span>(fitted_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 emp_ft   R-squared:                       0.015
Model:                            OLS   Adj. R-squared:                  0.012
Method:                 Least Squares   F-statistic:                     4.246
Date:                Tue, 20 May 2025   Prob (F-statistic):             0.0400
Time:                        21:48:14   Log-Likelihood:                -1385.7
No. Observations:                 384   AIC:                             2775.
Df Residuals:                     382   BIC:                             2783.
Df Model:                           1                                         
Covariance Type:                  HC0                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const         -2.3000      1.246     -1.847      0.065      -4.741       0.141
Treated        2.7498      1.335      2.061      0.039       0.134       5.365
==============================================================================
Omnibus:                       33.243   Durbin-Watson:                   2.194
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               95.234
Skew:                          -0.362   Prob(JB):                     2.09e-21
Kurtosis:                       5.330   Cond. No.                         4.32
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC0)</code></pre>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="estimation-of-full-twfe-equation" class="slide level4 scrollable">
<h4>Estimation of Full TWFE Equation</h4>
<ul>
<li class="fragment">Can estimate without differencing data ourselves using <code>linearmodels</code> or <code>pyfixest</code> (more details in next lecture)</li>
<li class="fragment">Here use <code>PanelOLS</code> from <code>linearmodels</code> with <code>entity_effects</code> (<span class="math inline">\(\alpha_i\)</span>) and <code>time_effects</code> (<span class="math inline">\(\gamma\)</span>)</li>
</ul>
<div id="376a6025" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Estimation using <code>linearmodels</code></summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a>ck_data <span class="op">=</span> ck_data.reset_index().set_index([<span class="st">"store"</span>, <span class="st">"time"</span>])</span>
<span id="cb8-2"><a></a>endog <span class="op">=</span> ck_data[<span class="st">"emp_ft"</span>]</span>
<span id="cb8-3"><a></a>exog <span class="op">=</span> ck_data.index.get_level_values(<span class="dv">1</span>) <span class="op">*</span> ck_data.loc[:, <span class="st">"state"</span>]</span>
<span id="cb8-4"><a></a>exog.name <span class="op">=</span> <span class="st">"Treated"</span></span>
<span id="cb8-5"><a></a></span>
<span id="cb8-6"><a></a>twfe_results <span class="op">=</span> lm.PanelOLS(</span>
<span id="cb8-7"><a></a>  endog, </span>
<span id="cb8-8"><a></a>  exog,  </span>
<span id="cb8-9"><a></a>  entity_effects<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-10"><a></a>  time_effects<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-11"><a></a>  drop_absorbed<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-12"><a></a>).fit(cov_type<span class="op">=</span><span class="st">"robust"</span>)</span>
<span id="cb8-13"><a></a><span class="bu">print</span>(twfe_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          PanelOLS Estimation Summary                           
================================================================================
Dep. Variable:                 emp_ft   R-squared:                        0.0147
Estimator:                   PanelOLS   R-squared (Between):              0.0865
No. Observations:                 768   R-squared (Within):              -0.0506
Date:                Tue, May 20 2025   R-squared (Overall):              0.0813
Time:                        21:48:14   Log-likelihood                   -2239.1
Cov. Estimator:                Robust                                           
                                        F-statistic:                      5.6903
Entities:                         384   P-value                           0.0175
Avg Obs:                       2.0000   Distribution:                   F(1,382)
Min Obs:                       2.0000                                           
Max Obs:                       2.0000   F-statistic (robust):             4.2238
                                        P-value                           0.0405
Time periods:                       2   Distribution:                   F(1,382)
Avg Obs:                       384.00                                           
Min Obs:                       384.00                                           
Max Obs:                       384.00                                           
                                                                                
                             Parameter Estimates                              
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
Treated        2.7498     1.3380     2.0552     0.0405      0.1191      5.3806
==============================================================================

F-test for Poolability: 3.5258
P-value: 0.0000
Distribution: F(384,382)

Included effects: Entity, Time</code></pre>
</div>
</div>
<div class="footer">

</div>
</section>
<section id="discussion-of-estimation-results" class="slide level4">
<h4>Discussion of Estimation Results</h4>
<p><br></p>
<ul>
<li class="fragment">In both cases same estimate — 2.75 workers</li>
<li class="fragment">Same standard errors — 1.34</li>
<li class="fragment">Effect is significantly different from zero (at 5% level), though evidence is not overwhelming</li>
</ul>
</section>
<section id="including-covariates" class="slide level4 scrollable">
<h4>Including Covariates</h4>
<ul>
<li class="fragment">Restaurants that open for longer tend to have more workers — want to include this</li>
<li class="fragment">Easy to do with <code>linearmodels</code>, just add variable to <code>exog</code></li>
<li class="fragment">Find similar effect</li>
</ul>
<div class="fragment">
<div id="a5b97249" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Adding linear covariates to TWFE DiD regression</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a>exog <span class="op">=</span> pd.DataFrame(exog)</span>
<span id="cb10-2"><a></a>exog[<span class="st">"hoursopen"</span>] <span class="op">=</span> ck_data[<span class="st">"hoursopen"</span>]</span>
<span id="cb10-3"><a></a>exog <span class="op">=</span> exog.dropna() </span>
<span id="cb10-4"><a></a><span class="co"># Align index of endog with exog</span></span>
<span id="cb10-5"><a></a>endog <span class="op">=</span> endog[exog.index]</span>
<span id="cb10-6"><a></a></span>
<span id="cb10-7"><a></a>twfe_results <span class="op">=</span> lm.PanelOLS(endog, exog,  entity_effects<span class="op">=</span><span class="va">True</span>, time_effects<span class="op">=</span><span class="va">True</span>, drop_absorbed<span class="op">=</span><span class="va">True</span>).fit(cov_type<span class="op">=</span><span class="st">"robust"</span>)</span>
<span id="cb10-8"><a></a><span class="bu">print</span>(twfe_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          PanelOLS Estimation Summary                           
================================================================================
Dep. Variable:                 emp_ft   R-squared:                        0.0312
Estimator:                   PanelOLS   R-squared (Between):              0.8836
No. Observations:                 761   R-squared (Within):              -0.0262
Date:                Tue, May 20 2025   R-squared (Overall):              0.8501
Time:                        21:48:14   Log-likelihood                   -2203.5
Cov. Estimator:                Robust                                           
                                        F-statistic:                      6.0137
Entities:                         384   P-value                           0.0027
Avg Obs:                       1.9818   Distribution:                   F(2,374)
Min Obs:                       1.0000                                           
Max Obs:                       2.0000   F-statistic (robust):             7.8111
                                        P-value                           0.0005
Time periods:                       2   Distribution:                   F(2,374)
Avg Obs:                       380.50                                           
Min Obs:                       377.00                                           
Max Obs:                       384.00                                           
                                                                                
                             Parameter Estimates                              
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
Treated        2.7702     1.3213     2.0967     0.0367      0.1722      5.3683
hoursopen      1.1348     0.3347     3.3904     0.0008      0.4767      1.7930
==============================================================================

F-test for Poolability: 2.2060
P-value: 0.0000
Distribution: F(384,374)

Included effects: Entity, Time</code></pre>
</div>
</div>
<div class="footer">

</div>
</div>
</section>
</section>
<section>
<section id="recap-and-conclusions" class="title-slide slide level2 center" data-background="#00100F">
<h2>Recap and Conclusions</h2>

</section>
<section id="recap" class="slide level4">
<h4>Recap</h4>
<p>In this lecture we</p>
<ol type="1">
<li class="fragment">Discussed a way to handle changes over time — parallel trends</li>
<li class="fragment">Identified ATT for binary treatment with difference-in-differences strategy</li>
<li class="fragment">Gave a regression (TWFE) characterization of DiD estimation</li>
<li class="fragment">Proposed some extensions</li>
</ol>
</section>
<section id="next-questions" class="slide level4">
<h4>Next Questions</h4>
<ul>
<li class="fragment">How is the TWFE regression actually estimated?</li>
<li class="fragment">What if the treatment is not binary?</li>
</ul>
</section>
<section id="references-1" class="slide level4 allowframebreaks smaller scrollable" data-visibility="uncounted">
<h4>References</h4>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Card1994MinimumWagesEmployment" class="csl-entry" role="listitem">
Card, David, and Alan Krueger. 1994. <span>“Minimum <span>Wages</span> and <span>Employment</span>: <span>A Case Study</span> of the <span>Fast Food Industry</span> in <span>New Jersey</span> and <span>Pennsylvania</span>.”</span> <em>American Economic Review</em> 84 (4): 772–93. <a href="https://doi.org/10.3386/w4509">https://doi.org/10.3386/w4509</a>.
</div>
<div id="ref-Cunningham2021CausalInferenceMixtape" class="csl-entry" role="listitem">
Cunningham, Scott. 2021. <em>Causal <span>Inference</span>: <span>The Mixtape</span></em>. Yale University Press. <a href="https://doi.org/10.2307/j.ctv1c29t27">https://doi.org/10.2307/j.ctv1c29t27</a>.
</div>
<div id="ref-Hansen2022Econometrics" class="csl-entry" role="listitem">
Hansen, Bruce. 2022. <em>Econometrics</em>. Princeton_University_Press.
</div>
<div id="ref-Huntington-Klein2025EffectIntroductionResearch" class="csl-entry" role="listitem">
Huntington-Klein, Nick. 2025. <em>The <span>Effect</span>: <span>An Introduction</span> to <span>Research Design</span> and <span>Causality</span></em>. S.l.: <span>Chapman and Hall/CRC</span>.
</div>
<div id="ref-Neumark2014RevisitingMinimumWage" class="csl-entry" role="listitem">
Neumark, David, J M Ian Salas, and William Wascher. 2014. <span>“Revisiting the <span>Minimum Wage</span>—<span>Employment Debate</span>: <span>Throwing Out</span> the <span>Baby</span> with the <span>Bathwater</span>?”</span> <em>ILR Review</em> 67 (3): 608–48. <a href="https://doi.org/10.1177/00197939140670S307">https://doi.org/10.1177/00197939140670S307</a>.
</div>
<div id="ref-Roth2023WhatsTrendingDifferenceinDifferences" class="csl-entry" role="listitem">
Roth, Jonathan, Pedro H. C. Sant’Anna, Alyssa Bilinski, and John Poe. 2023. <span>“What’s <span>Trending</span> in <span class="nocase">Difference-in-Differences</span>? <span>A Synthesis</span> of the <span>Recent Econometrics Literature</span>.”</span> <em>Journal of Econometrics</em> 235 (2): 2218–44. <a href="https://doi.org/10.1016/j.jeconom.2023.03.008">https://doi.org/10.1016/j.jeconom.2023.03.008</a>.
</div>
<div id="ref-Snow1856ModeCommunicationCholera" class="csl-entry" role="listitem">
Snow, John. 1856. <span>“<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5307547">On the <span>Mode</span> of <span>Communication</span> of <span>Cholera</span></a>.”</span> <em>Edinburgh Medical Journal</em> 1 (7): 668–70.
</div>
<div id="ref-Wooldridge2020IntroductoryEconometricsModern" class="csl-entry" role="listitem">
Wooldridge, Jeffrey M. 2020. <em>Introductory <span>Econometrics</span>: A <span>Modern Approach</span></em>. Seventh edition. Boston, MA: Cengage.
</div>
</div>
<div class="footer">

</div>


<div class="reveal-header">
<div class="header-logo" data-footer-logo-link="https://vladislav-morozov.github.io/econometrics-2/">
<img data-src="">
</div>
<div class="sc-title">
<p> </p>
</div>
<div class="header-text">
<p> </p>
</div>
<div class="sb-title">
<p> </p>
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../themes/favicon.ico" class="slide-logo"></p>
<div class="footer footer-default">
<p>Panel Data: Difference-in-Differences</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'convex',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'fast',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1150,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/vladislav-morozov\.github\.io\/econometrics-2\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>