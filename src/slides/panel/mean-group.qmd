---
title: "Mean Group Estimation"
subtitle: "Learning Average Effects in Linear Panel Data Models"
author: Vladislav Morozov  
format:
  revealjs:
    include-in-header: 
      text: |
        <meta name="description" content="  (lecture notes slides)."/>
    width: 1150
    slide-number: true
    sc-sb-title: true
    incremental: true   
    logo: ../../themes/favicon.ico
    footer: "Panel Data: Mean Group"
    footer-logo-link: "https://vladislav-morozov.github.io/econometrics-2/"
    theme: ../../themes/slides_theme.scss
    toc: TRUE
    toc-depth: 2
    toc-title: Contents
    transition: convex
    transition-speed: fast
slide-level: 4
title-slide-attributes:
    data-background-color: "#045D5D"
    data-footer: " "
filters:
  - reveal-header  
include-in-header: ../../themes/mathjax.html 
highlight-style: tango
open-graph:
    description: " "
---



## Introduction {background="#00100F"}
  
### Lecture Info {background="#43464B" visibility="uncounted"}


#### Learning Outcomes

This lecture is about  

<br>

By the end, you should be able to

- State the  

#### References
 
Mean group estimation rarely discussed in textbooks

<br>

Just two references:

::: {.nonincremental}

- 28.5 in @Pesaran2015TimeSeriesPanel
- Some discussion in section 6 of [notes from my graduate class](https://vladislav-morozov.github.io/econometrics-heterogeneity/linear/linear-mean-group.html) on estimation with unobserved heterogeneity
:::  

 

### Motivation {background="#43464B" visibility="uncounted"}

#### Theoretical Motivation: Model and Object of Interest

Consider potential outcome model:
$$
Y_{it}^{\bx} = \bx'\bbeta_{\textcolor{teal}{i}} + U_{it}
$$ {#eq-panel-mg-causal-model}

<span class="highlight">Heterogeneous</span> coefficients realistic:

- Different people react differently to same change in $\bx$
- Average effect of going from $\bx_1$ to $\bx_2$ is $(\bx_2-\bx_1)'\E[\bbeta_i]$

. . . 

<div class="rounded-box">

Want to learn $\E[\bbeta_i]$

</div>

#### Issue with FE Estimators and This Lecture

Last time proved that under model ([-@eq-panel-mg-causal-model]) FE estimators estimate <span class="highlight">weighted</span> average 
$$
\hat{\bbeta}^{FE} \xrightarrow{p} \E[\bW(\tilde{\bX}_i)\bbeta_i]
$$
Outside of RCTs usually $\E[\bW(\tilde{\bX}_i)\bbeta_i]\neq \E[\bbeta_i]$

- Weights $\bW(\cdot)$ "nice": positive definite and integrate to 1
- But $\bW(\cdot)$ — difficult to interpret

<div class="rounded-box">

This lecture — way to estimate $\E[\bbeta_i]$ with panel data

</div>

::: footer

:::

#### Empirical Motivation {.scrollable}

Last time discussed relationship between pollution and labor market outcomes using US county-level data

. . . 


<div class="rounded-box">
 
What if pollution effect differs between counties?

</div>


- E.g. due to different population characteristics (age, health, ...)
- Would be an example of model ([-@eq-panel-mg-causal-model]). FE estimate from last time would be $\E[\bW(\tilde{\bX})\bbeta_i]$
- <span class="highlight">What is $\E[\bbeta_i]$? </span>
 

## Theory {background="#00100F"}

### Construction {background="#43464B" visibility="uncounted"}


#### Model and Data

Vector form of realized outcomes in model ([-@eq-panel-mg-causal-model]):
$$
\bY_i = \bX_i\bbeta_i + \bU_i
$$
$\bbeta_i$ — $p$-vector. Interested in $\E[\bbeta_i]$

. . .

<br>

<div class="rounded-box">

**Assumption**: $T\geq p$

</div>
At least as many observations as there are coefficients

#### Individual Estimator

Key component — <span class="highlight"> individual estimators </span>
$$
\hat{\bbeta}_i = (\bX_i'\bX_i)^{-1}\bX_i'\bY_i
$$

- $\hat{\bbeta}_i$ — simply running OLS using the data only on unit $i$
- We assume that $(\bX_i'\bX_i)^{-1}$ exists
  - Assumption of variation in $\bX_{it}$ for unit $i$
  - May be tougher to satisfy if $T$ is small and $\bX_{it}$ has discrete regressors


#### Mean Group Estimator

<br>

<div class="rounded-box">

::: {#def-panel-mg-mg-estimator}

The mean group (MG) estimator is defined as
$$
\hat{\bbeta}^{MG} = \dfrac{1}{N}\sum_{i=1}^N \hat{\bbeta}_i
$$

:::

</div>

Cross-sectional average of individual OLS estimators

#### MG Estimation with Singular $(\bX_i'\bX_i)$

- So far: assumed that all units had invertible $(\bX_i'\bX_i)$
- If not true, can average only units which have invertible $(\bX_i'\bX_i)$ (=can compute $\hat{\bbeta}_i$)

. . . 

Can define MG estimator over such units as

$$ \small
\hat{\bbeta}^{MG, +}  = \dfrac{1}{\sum_{i=1}^N \I\curl{\det(\bX_i'\bX_i)>0} } \sum_{i=1}^N \I\curl{\det(\bX_i'\bX_i)>0} \hat{\bbeta}_i
$$

 




### Asymptotic Properties {background="#43464B" visibility="uncounted"}

#### Representation of $\hat{\bbeta}^{MG}$

Key expansion:
$$
\begin{aligned}
\hat{\bbeta}^{MG} & = \dfrac{1}{N}\sum_{i=1}^N \bbeta_i + \dfrac{1}{N} \sum_{i=1}^N (\bX_i'\bX_i)^{-1}\bX_i'\bU_i
\end{aligned} 
$$

. . .

<br>


- How to prove asymptotic properties? 
- Recall: usually want to impose assumptions on the "primitive" components $(\bbeta_i, \bX_i, \bU_i)$

#### Technique: Represent in Terms of One Vector

 

Represent $\hat{\bbeta}^{MG}$ as a continuous transformation of a single vector average:
$$
\hat{\bbeta}^{MG}  = \begin{pmatrix}
\bI_p & \bI_p
\end{pmatrix} \left[ \dfrac{1}{N} \sum_{i=1}^N \underbrace{\begin{pmatrix}
\bbeta_i \\
(\bX_i'\bX_i)^{-1}\bX_i'\bU_i
\end{pmatrix}}_{=\bW_i} \right]
$$

. . . 

Can now prove consistency and asymptotic normality results by applying LLN+CLT to $\bW_i$, then use CMT (<span class="highlight">exercise</span>)


#### Consistency of the MG Estimator

<div class="rounded-box">

::: {#prp-panel-mg-consistency}

If 

1. Units are IID
2. $\E[\bU_i|\bX_i]=0$
3. $\E[\norm{(\bX_i\bX_i')^{-1}\bX_i'\bU_i}]<\infty$, $\E[\norm{\bbeta_i}]<\infty$

Then as $N\to\infty$, $T\geq p$ fixed
$$
\hat{\bbeta}^{MG} \xrightarrow{p} \E[\bbeta_i]
$$

:::

</div>

::: footer

Assuming that $\E[\norm{(\bX_i\bX_i')^{-1}\bX_i'\bU_i}]<\infty$ — assumption of sufficient variation on $\bX_i$

::: 

#### Asymptotic Distribution
 
<div class="rounded-box">

::: {#prp-panel-mg-distribution}

If 

1. Units are IID
2. $\E[\bU_i|\bbeta_i, \bX_i]=0$
3. $\E[\norm{(\bX_i\bX_i')^{-1}\bX_i'\bU_i}^2]<\infty$, $\E[\norm{\bbeta_i}^2]<\infty$

Then as $N\to\infty$, $T\geq p$ fixed
$$\small
\sqrt{N}\left(\hat{\bbeta}^{MG} - \E[\bbeta_i] \right) \xrightarrow{d} N(0, \var(\bbeta_i) + \var\left( (\bX_i'\bX_i)^{-1}\bX_i'\bU_i \right)
$$

:::

</div>

#### Estimating the Asymptotic Variance

Need $\widehat{\avar}(\hat{\bbeta}^{MG})$ if we want to do inference on $\E[\bbeta_i]$

. . .

<br>

Correct answer — the simplest one: 

- $\hat{\bbeta}^{MG}$ — sample average of $\hat{\bbeta}_i$
- Way to estimate variance — sample variance of $\hat{\bbeta}_i$:
$$ \small
\begin{aligned}
& \dfrac{1}{N}\sum_{i=1}^N(\hat{\bbeta_i}-\hat{\bbeta}^{MG})(\hat{\bbeta_i}-\hat{\bbeta}^{MG})'\xrightarrow{p} \var\left(\hat{\bbeta}_i \right) = \avar\left(\hat{\bbeta}^{MG}\right)
\end{aligned}
$$

::: footer

Pretty obvious result and follows directly from LLN and CLT. But useful to express the MG estimator in terms of the "primitive" data $(\bX_i, \bU_i)$

:::


## Empirical Illustration {background="#00100F"}

### Context and Setting {background="#43464B" visibility="uncounted"}

#### Reminder: Empirical Question

Recall: studying relationship between pollution and earnings using approach of @Borgschulte2024AirPollutionLabor

- Data: quarterly county-level data from the USA
- Exogenous measure of pollution: number of days with wildfire smoke
- Outcomes: average earnings in county


#### Reminder: Previous Empirical Strategy
 
Last time assumed that two random intercepts <span class="highlight"> sufficient </span> to capture important unobserved components:

- County-season
- State-year

. . .

Unit of analysis effectively county in given season (e.g. King County in summer is a single $i$)

. . .

<br>


After that assumed that effect of pollution was same between places

#### Allowing Different Effects

What if pollution effects different between counties and seasons? 

- Specify model:
$$
Y_{it}^{\bx} = \alpha_i + \beta_i\text{Smoke Days}_{it} + \text{State-Year FE} + U_{it}
$$
- 


 

### Estimation and Results {background="#43464B" visibility="uncounted"}

#### 

Mean group not implemented anywhere (to the best of my knowledge), but very easy to do by hand

####

So is it because of the larger estimation error contribution? OR just not enough data points (very large $\var(\bbeta_i))$

- Can figure it out, but more advanced


::: footer

Variance can be identified and estimated, see 

:::

## Recap and Conclusions {background="#00100F"}
  
#### Recap

In this lecture we

1. Discussed 

#### Next Questions

- What if we don't care about causal parameters and only want to predict outcomes?
- When does strict exogeneity fail? What is the impact of that failure?  

#### References {.allowframebreaks visibility="uncounted"}

::: {#refs}
:::

::: footer

:::