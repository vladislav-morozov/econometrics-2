---
title: "Difference-in-Differences"
subtitle: "Causal Inference of Binary Treatment under Parallel Trends"
author: Vladislav Morozov  
format:
  revealjs:
    width: 1150
    slide-number: true
    sc-sb-title: true
    incremental: true   
    logo: ../../themes/favicon.ico
    footer: "Panel Data: Difference-in-Differences"
    footer-logo-link: "https://vladislav-morozov.github.io/econometrics-2/"
    theme: ../../themes/slides_theme.scss
    toc: TRUE
    toc-depth: 2
    toc-title: Contents
    transition: convex
    transition-speed: fast
slide-level: 4
title-slide-attributes:
    data-background-color: "#045D5D"
    data-footer: " "
filters:
  - reveal-header  
include-in-header: ../../themes/mathjax.html 
highlight-style: tango
---

## Introduction {background="#00100F"}
  
### Lecture Info {background="#43464B" visibility="uncounted"}


#### Learning Outcomes

This lecture    

<br>

By the end, you should be able to

- Write  
  
#### References
 

::: {.nonincremental}

Textbooks: 

- Chapter 18 in @Huntington-Klein2025EffectIntroductionResearch
- "Difference-in-Differences" in @Cunningham2021CausalInferenceMixtape
- Chapter 13.2 in @Wooldridge2020IntroductoryEconometricsModern
- Chapter 18 in @Hansen2022Econometrics

@Roth2023WhatsTrendingDifferenceinDifferences: good overview of recent advances

:::  

 

### Empirical Motivation {background="#43464B" visibility="uncounted"}

#### Context {#sec-event-study-svb-example}

 
@Card1994MinimumWagesEmployment
 

#### Empirical Question {.scrollable}

<div class="rounded-box">

Does raising the minimum wage reduce employment? 

 
</div>
 

## Identification {background="#00100F"}


#### Motivation

Previous lecture — "event studies" with "no trends" in average untreated outcome: $\E[Y_{it}^0]$ does not depend on $t$
 
<br>
 
<div class="rounded-box">

Assumption of no trends <span class="highlight">difficult to justify</span> unless time horizon very short 

</div>

- If there are trends, event studies do not work
- What can we do?
 

### Two-Unit Thought Experiment {background="#43464B" visibility="uncounted"}

#### Setting: Two Units with Binary Treatment

To start: very simplified case

- Two periods of time: $t=1, 2$
- Two units: unit 1 with outcomes $Y$ and unit 2 with outcome $Z$
- Second unit treated between $t=1$ and $t=2$. First unit not treated

. . .

Potential outcomes at time $t$: $Y_t^d$ and $Z_t^d$ for treatment values $d=0, 1$

#### Object of Interest 

<br>

Object of interest: <span class="highlight">treatment effect</span> of unit 2 at $t=2$:
$$
\delta_Z = Z_2^1- Z_2^0
$$


#### Change in Outcomes

Observed outcomes satisfy
$$
Z_{1} = Z_1^0, \quad Z_{2} = Z_{2}^1
$$

. . .

Difference in outcomes (like in event studies):
$$
\begin{aligned}
Z_2 - Z_1 & = \gamma_T + \delta_T\\
\gamma_T & = Z_{2}^0 - Z_{1}^0
\end{aligned}
$$
$\gamma_T$ — trend in outcomes without treatment

#### Role of Assumptions of No Trends

Strict no trends assumption from previous lecture:
$$
\gamma_T = 0
$$ {#eq-panel-did-no-trends}

. . .

- Under ([-@eq-panel-did-no-trends]) $Z_2-Z_1=\delta_T$ — identification of treatment effect
- Without ([-@eq-panel-did-no-trends]) change in outcome — sum of treatment effect and evolution over time
- Hard to justify ([-@eq-panel-did-no-trends]) outside of high-frequency data

#### Trend for Other Unit

Outcomes of other unit satisfy:
$$
Y_1 = Y_1^0, \quad Y_2 = Y_2^0
$$


. . .

<br> 

Difference in outcomes: only trend in outcomes without treatment
$$
\begin{aligned}
Y_2 - Y_1 & = \gamma_U\\
\gamma_U & = Y_2^0 - Y_1^0
\end{aligned}
$$

#### Parallel Trends 

Difference in differences of outcomes of units:
$$
\begin{aligned}
(Z_2- Z_1) - (Y_2- Y_1) = \delta_T + (\gamma_T - \gamma_U)
\end{aligned}
$$

. . .

<br>

What if the two units had the same evolution? 
<div class="rounded-box">

**Assumption** (*literal parallel trends*):
$$
\gamma_T = \gamma_U
$$

</div>

#### Difference-in-Differences with Two Units

Under parallel trends identify $\delta_T$ as 
$$
\delta_T = (Z_2- Z_1) - (Y_2- Y_1)
$$ 

- Differences two unit-specific differences — hence called difference-in-difference<span class="highlight">s</span>
- Old argument, goes back at least to @Snow1856ModeCommunicationCholera

 

### Differences-in-Differences {background="#43464B" visibility="uncounted"}

#### Limitations of Two Unit Approach

Two unit situation might be

- Unrealistic: literal parallel trends might not hold
- Uninteresting: if you want to predict the effect for a new unit

. . .

<br>

$\Rightarrow$ Now consider an approach with <span class="highlight">multiple</span> units


#### Setting

- Units indexed by $i=1, \dots, N$, time indexed by $t=1, 2$
- All outcomes labeled $Y_{it}$
- Treatment pattern: realized treatment indicator $D_{it}$
  - Untreated/control group (group $U$): $D_{i1}=D_{i2}=0$
  - Treated group (group $T$): $D_{i1}=0$, $D_{i2}=1$

#### Potential Outcomes

Potential outcomes $Y_{it}^d$ for $d=0, 1$

- Units in group $T$:
$$
Y_{i1} = Y_{i1}^0, \quad Y_{i2} = Y_{i2}^1
$$
- Units in group $U$ 
$$
Y_{i1} = Y_{i1}^0, \quad Y_{i2}= Y_{i2}^0
$$

#### Change in Outcomes for Treated

Decompose average of $Y_{i2}-Y_{i1}$ for treated units ($T$):
$$
\E[Y_{i2} - Y_{i1}|T] = \E[Y_{i2}^1 - Y_{i2}^0|T]  + \E[Y_{i2}^0- Y_{i1}^0|T]
$$

- $\E[Y_{i2}^1 - Y_{i2}^0|T]$ — parameter of interest, the <span class="highlight">average treatment effect for the treated</span> (ATT)
- $\E[Y_{i2}^0- Y_{i1}^0|T]$ trend in outcomes without treatment

#### Change in Outcomes for Untreated

<br>

For untreated units ($U$):
$$
\E[Y_{i2}-Y_{i1}|U] = \E[Y_{i2}^0 - Y_{i1}^0|U]
$$

<br>

Only the time trend is present

#### Parallel Trends Assumption

Same trends on average:
<div class="rounded-box">

**Assumption** (*average parallel trends*):
$$
\E[Y_{i2}^0 - Y_{i1}^0|T] = \E[Y_{i2}^0 - Y_{i1}^0|U] 
$$

</div>
 

Then <span class="highlight">difference-in-differences</span> 
$$
\begin{aligned}
\E[Y_{i2}^1 - Y_{i2}^0|T] & = \E[Y_{i2}-Y_{i1}|T] - \E[Y_{i2}-Y_{i1}|U] 
\end{aligned}
$$
Expressed ATT in terms of distribution of the data

#### Result Statement

<div class="rounded-box">
 

::: {#prp-causal-did-att-canonical}

## DiD Identification

Suppose that $P(D_{i1}=D_{i2} =0)>0$ and $P(D_{i1}=0, D_{i2}=1)>0$. 

Then the ATT is $\E[Y_{i2}^1 - Y_{i2}^0|T]$ is identified in terms of a difference in differences:
$$
\begin{aligned}
\E[Y_{i2}^1 - Y_{i2}^0|T] & = \E[Y_{i2}-Y_{i1}|T] - \E[Y_{i2}-Y_{i1}|U] 
\end{aligned}
$$

:::


</div>

<br> 

Assumption means that both treated and untreated units exist

#### Discussion

What does DiD actually do? 

- Solves selection in treatment by
  - Considering effects only for the treated (ATT instead of ATE$=\E[Y_{i2}^1 - Y_{i2}^0]$)
  - Compares treated units to themselves
- Solves evolution over time by
  - Assuming parallel trends without treatment
  - Identifies trend from untreated unit

 

## Estimation and Regression View {background="#00100F"}

<!-- ### Estimation and Regression View {background="#43464B" visibility="uncounted"} -->

#### DiD Estimator

We have $ATT = \E[Y_{i2}-Y_{i1}|T] - \E[Y_{i2}-Y_{i1}|U]$

. . .


Sample version: the <span class="highlight">DiD estimator</span>:
<div class="rounded-box">
$$
\begin{aligned}
 \hspace{-2.6cm} & \hspace{-2.6cm}\widehat{ATT}^{DID} \\
 \hspace{-2.6cm} & \hspace{-2.6cm} = \dfrac{1}{N_T}\sum_{Treated} (Y_{i2}-Y_{i1}) - \dfrac{1}{N_U}\sum_{Untreated} (Y_{i2}-Y_{i1})
\end{aligned}
$$ {#eq-causal-did-canonical-did-estimator}
</div>
$N_T$ — number of treated units, $N_U$ — of untreated units


#### Regression Representation: Coefficients

Can frame DiD estimator differently

. . . 

Define  "coefficients":
$$
\begin{aligned}
\alpha_i & = Y_{i1}^0, \\
\gamma & = \E[Y_{i2}^0 - Y_{i1}^0 |T], \\
\delta & = \E[Y_{i2}^1 - Y_{i2}^0 |T].
\end{aligned}
$$

By parallel trends, can also have $\gamma = \E[Y_{i2}^0 - Y_{i1}^0 |U]$ 

#### Regression Representation: Outcomes

Recall $D_{it}$. Define indicator of second period:
$$
SP_{it} = \I\curl{t=2}
$$ 

. . . 

Can express outcomes as
$$
Y_{it} = \begin{cases}
\alpha_i + u_{it}, & SP_{it} =0, D_{i2}= 0, 1, \\
\alpha_i + \gamma + u_{it}, & SP_{it} = 1, D_{i2} = 0, \\
\alpha_ i + \gamma + \delta + u_{it}, & SP_{it}, D_{i2} = 1,
\end{cases}
$$
What is the $u_{it}$?

#### TWFE Representation

Compact form of representation: 
$$
Y_{it} = \alpha_i + \gamma SP_{it} + \delta D_{it} + u_{it}
$$ {#eq-causal-did-twfe-general}
@eq-causal-did-twfe-general is called <span class="highlight">two-way fixed effect</span> model (more on that in next lecture)

. . .

Can eliminate $\alpha_i$ by taking <span class="highlight">first differences</span> across time to get
$$
Y_{i2}- Y_{i1} = \gamma + \delta D_{it} + u_{i2}
$$ {#eq-causal-did-twfe}

#### Regression Representation: Result

<div class="rounded-box">



::: {#prp-causal-did-canonical-did-is-twfe}

## Canonical DiD is TWFE

The OLS estimator $\hat{\delta}$ in @eq-causal-did-twfe satisfies
$$
\hat{\delta} = \widehat{ATT}^{DID},
$$
for the ATT estimator of @eq-causal-did-canonical-did-estimator.

:::


</div>

Proof: by brute force evaluating the OLS estimator, see exercise set 3


#### Regression Representation: Discussion

- Like for event studies: managed to get linear regression in a nonparametric context
- Consistency of OLS = consistency of $\widehat{ATT}^{DID}$ (exercise: prove that parallel trends equivalent to strict exogeneity of $D_{it}$)
- Regression results: can use all results for OLS, including limit theory and inference

#### Limitations

Two obvious ones:

- Need parallel trends 
- Do not identify average effect for the untreated and the overall ATE

<br> 

. . .

Can relax a bit if we have another "control" group — DDD identification and estimator (see @Cunningham2021CausalInferenceMixtape or @Wooldridge2020IntroductoryEconometricsModern) 

#### 

## Some Extensions {background="#00100F"}

#### Adding Covariates I: Conditioning

What if there are extra covariates $\bX_i = (\bX_{i1}, \bX_{i2})$?

. . . 

Can relax parallel trends to conditional parallel trends: for each (or some) values $\bx=(\bx_1, \bx_2)$
$$ \small
\E[Y_{i2}^0 - Y_{i1}^0 |T, \bX_{it}=\bx] = \E[Y_{i2}^0 - Y_{i1}^0 |T, \bX_{i}=\bx] 
$$

. . .

Same argument as before: identify <span class="highlight">conditional ATT</span>
$$\small
CATT(\bx) = \E[Y_{i2}^0 - Y_{i1}^0 |T, \bX_{i}=\bx]
$$

. . . 

If parallel trends hold for all possible $\bx$, can also identify the overall ($\bX$-unconditional) ATT

::: footer

:::

#### Adding Covariates II: Assuming Linearity

Often see <span class="highlight">linearity assumptions</span> on the causal model in the form:
$$
\begin{aligned}
Y_{it}^d = Y_{it}^0 + d(Y_{i2}^1- Y_{i2}^0) + \bX_{it}'\bbeta_i
\end{aligned}
$$

. . . 

Can estimate ATT consistently from TWFE regression
$$
Y_{i2}-Y_{i1} = \gamma + \delta D_{it} + (\bX_{i2}-\bX_{i1})'\bbeta + u_{it},
$$
if $\bbeta$ appropriately defined (think of OLS estimator under heterogeneous coefficient causal model)

#### Adding More Periods: Setting

Can accommodate more periods of data

- $T\geq 2$
- Two groups: never treated ($U$) and treated, treatment starts between $t_0-1$ and $t_0$
- Treatment indicators $D_{it\tau}$, $t, \tau=1,\dots, T$: 
  - Untreated units have $D_{it\tau}=0$ for all $t, \tau$
  - Treated units $D_{it\tau}=1$ if and only if $t=\tau$ and $t\geq t_0$
 
#### Adding More Periods: TWFE

Multi-period specification:
$$ \small
\begin{aligned}
Y_{it} &  = \alpha_i + \gamma_t + \sum_{\tau=t_0}^T \delta_\tau D_{it\tau}  + U_{it},\\
\alpha_i & = Y_{i1}^0, \\
\gamma_t & = \E[Y_{it}^0- Y_{i1}^0|T],\\
\delta_t & = \E[Y_{i2}^1- Y_{i1}^0|T]
\end{aligned}
$$ 
OLS consistent for dynamic ATTs $\delta_T$ if   
$$ \small
\E[Y_{it}^0- Y_{i1}^0|T]=\E[Y_{it}^0- Y_{i1}^0|U]
$$

::: footer


:::

#### Adding More Groups

- So far: had two groups (untreated and treated at some specific point in time)
- In many settings: different units receive treatment in different periods (e.g. states implement same laws at different times)
- Can learn with such <span class="highlight">staggered timing</span>
- Need to be careful, cannot just do TWFE, need more sophisticated approaches

. . .

See section 3 in @Roth2023WhatsTrendingDifferenceinDifferences

 


## Empirical Application {background="#00100F"}
 
 
### Subsection {background="#43464B" visibility="uncounted"}

####

Units $i$ are restaurants Groups correspond to states

## Recap and Conclusions {background="#00100F"}
  
#### Recap

In this lecture we

1. Introduced 

#### Next Questions

- How is the TWFE regression actually estimated? 
- What if the treatment is not binary

#### References {.allowframebreaks visibility="uncounted"}

::: {#refs}
:::